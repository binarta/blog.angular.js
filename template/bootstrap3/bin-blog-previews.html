<div class="container bin-blog bin-blog-previews"
     ng-controller="BinartaSearchController as searchCtrl"
     ng-init="searchCtrl.init({
                entity:'catalog-item',
                context:'search',
                filters:{
                    type:'blog',
                    blogType: settings.blogType,
                    status:'published',
                    locale: settings.multilingualism ? 'locale' : 'default',
                    sortings: [
                        {on:'creationTime', orientation:'desc'}
                    ]
                },
                autosearch:true,
                noMoreResultsNotification: false,
                subset:{count:5}})">
    <div checkpoint-permission-for="catalog.item.add">
        <div class="row" ng-if="permitted">
            <div class="col-sm-8 col-sm-offset-4" ng-controller="AddToCatalogController"
                 ng-init="init({partition:'/blog/', type:'blog', redirectToView:true, editMode:true})">
                <div class="bin-add-article-button-wrapper" ng-controller="AddBlogController">
                    <div class="alert alert-info" ng-if="::mainLocale != locale && !settings.multilingualism"
                         i18n code="blog.article.main.language.restriction.message" read-only>
                        <i class="fa fa-info-circle fa-fw"></i> {{::var}} ({{::mainLocale|toLanguageName}})
                    </div>

                    <button type="button" class="btn btn-primary bin-add-article-button" ng-disabled="working"
                            ng-if="::mainLocale == locale || settings.multilingualism"
                            ng-click="item.blogType = blogTypes[0].code;submit()"
                            i18n code="blog.article.add.new.button" read-only>
                        <span ng-hide="working"><i class="fa fa-plus fa-fw"></i> {{::var}}</span>
                        <span ng-show="working"><i class="fa fa-spinner fa-spin fa-fw"></i></span>
                    </button>
                </div>
                <hr>
            </div>
        </div>
    </div>

    <article class="row bin-article" ng-repeat="item in searchCtrl.results track by item.id" i18n code="{{::item.id}}.body" var="body" read-only no-locale>
        <div class="col-sm-4">
            <div class="bin-article-image-wrapper" checkpoint-permission-for="edit.mode">
                <span ng-if="body != '' || permitted">
                    <a ng-href="#!{{::localePrefix}}/view{{::item.id}}">
                        <img class="img-responsive" bin-image="images{{::item.id}}/cover.img" alt="blog post cover image">
                    </a>
                </span>
                <span ng-if="body == '' && !permitted">
                    <img class="img-responsive" bin-image="images{{::item.id}}/cover.img" alt="blog post cover image">
                </span>
            </div>
        </div>
        <div class="col-sm-8">
            <div class="well clearfix bin-article-heading">
                <div class="row">
                    <div class="col-sm-12">
                        <h2 class="inline bin-article-title" checkpoint-permission-for="edit.mode">
                            <a ng-href="#!{{::localePrefix}}/view{{::item.id}}" ng-if="body != '' || permitted"
                               i18n code="{{::item.id}}" default="{{::item.id}}" read-only no-locale>
                                {{::var}}
                            </a>
                            <span ng-if="body == '' && !permitted"
                                  i18n code="{{::item.id}}" default="{{::item.id}}" read-only no-locale>
                                {{::var}}
                            </span>
                        </h2>
                        <ul class="list-inline">
                            <li>
                                <i class="fa fa-clock-o fa-fw"></i>
                                {{::item.creationTime | amDateFormat:'MMMM DD, YYYY'}}
                            </li>
                            <li ng-if="settings.useBlogTypes">
                                <i class="fa fa-tag fa-fw"></i>
                                <i18n class="inline" code="blog.type.{{item.blogType}}" default="{{item.blogType}}" read-only>{{::var}}</i18n>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <p class="bin-article-lead" i18n code="{{::item.id}}.lead" editor="full" read-only no-locale ng-bind-html="::var|trust"></p>

            <span i18n code="blog.read.more" read-only ng-if="body != ''">
                <a ng-href="#!{{::localePrefix}}/view{{::item.id}}" class="read-more" title="Read More">
                    {{::var}}
                </a>
            </span>
        </div>
        <div class="col-sm-8 col-sm-offset-4">
            <hr>
        </div>
    </article>


    <div ng-if="searchCtrl.results.length == 0 && !searchCtrl.working">
        <ng-include src="'search-for-more.html'"></ng-include>
    </div>
    <div class="row" ng-if="searchCtrl.results.length >= 5">
        <div class="col-sm-8 col-sm-offset-4">
            <hr>
            <ng-include src="'search-for-more.html'" ng-init="infiniteScrolling = true"></ng-include>
        </div>
    </div>
</div>